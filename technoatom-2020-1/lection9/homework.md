## Домашнее задание №3 - Backend: linux, DB

### Цель домашнего задания:

- Анализировать nginx логи
- Освоить написание bash скриптов в одну строчку
- Научиться писать bash/python скрипты, параметризация скриптов
- Научиться работать с СУБД из Python
- Получить навыки использования ORM
- Научиться создавать и использовать Mock сервер для тестирования
- Научиться выполнять минимальную настройку базовых демонов Linux


### Задачи (всего 21 балл).
#### Bash scripting (максимум 5 баллов)
Написать скрипт на bash и python для анализа готового access.log

Должен быть README файл, который описывает как работает каждый скрипт.
В случае если файл не может быть обработан, то скрипт должен завершится с ошибкой.

Как пример, nginx логи можно взять вот тут:
https://github.com/elastic/examples/blob/master/Common%20Data%20Formats/nginx_logs/nginx_logs

Условия и для bash и для python скриптов (4 балла):
- Должна быть возможность указать директорию где искать конкретный файл с логом - (0,5 балла)
- Для access.log файла должна собираться следующая информация:
    - Общее количество запросов (0,5 балла)
    - Количество запросов по типу, например: GET - 20, POST - 10 и т.д. (0,5 балла)
    - Топ 10 самых больших по размеру запросов, должно быть видно url, код, число запросов (1 балл)
    - Топ 10 запросов по количеству, которые завершились клиентской ошибкой, должно быть видно url, статус код, ip адрес (1 балл)
    - Топ 10 запросов клиентских ошибок по размеру запроса, должно быть видно url, статус код, ip адрес (1 балл)
    
Результаты нужно сохранять в произвольный файл через любой делимитер (должен быть указан в README) 

Дополнительное условие для python скрипта (1 балл):
- возможность указать директорию где искать лог или логи - в этом случае обрабатывать все логи из директории (0,5 балла)
- возможность сохранять собранные данные в json, скруктура произвольная (0,5 балла)


#### Работа с БД, ORM (максимум 4 балла)
Написать скрипт на Python для создания БД и добавления данных логов
Все нижеперечисленные действия должны выполняться из Python

Условия: 

- Создать mysql БД для логов (0,5 балла)
- Переписать логгер на python из задачи №1 так, чтобы действия записывались в БД (2 балла)
- Написать коннектор к базе данных. Создать любую сущность через БД и написать тест проверки её создания.
    - При использовавнии ORM (1,5 балла)
    - SQL запросы (0,5 балла)


#### Работа с Flask, Mock (максимум 6 баллов)
HTTP клиент, HTTP Mock сервер, тесты

Условия:

- Написать собственный HTTP клиент с использованием библиотеки socket
    - обработка ответа и вывод на экран в формате json: код ответа, заголовки, тело ответа (1 балл)
    - получение ответа и вывод на экран списка: код ответа, тело ответа (0,5 балла)
- Написать собственный HTTP Mock сервер на flask.
    - реализовать endpoint'а, который сохраняет в моке полученные данные для тестов в словарь (1 балл) 
    - реализовать для тестов 2 endpoint'а, один для GET, другой для POST запросов (1 балл)
    - реализовать для тестов 1 endpoint (0,5 балла)
- Написать тесты, на собственный мок сервер с использованием собственного клиента
    - тесты используют как http клиент библиотеку requests (0,5 балла) 
    - тесты используют как http клиент собственный клиент через socket (1 балл)
    - мок поднимается 1 раз, перед первым тестом, заввершается после выполнения последнего теста; все тестовые данные записываются 1 раз и потом используются для тестов (2 балла) 
    - мок поднимается и завершается на каждом тесте, тестовые данные для теста записываются в мок каждый раз (1 балл)


#### Настройка Linux

Настройка linux и написание тестов (максимум 6 баллов)

Условия:

- Настроить linux (максимум 2 балла):
	- поднять sshd демон на любом не дефолтном порту без выключения selinux и firewalld (0,5 балла)
	- поднять nginx демон на любом не дефолтном порту без выключения selinux и firewalld (1,5 балла)


Подключение к удаленной машине это всегда подключение по ssh

- Написать тесты (максимум балла 4)
    - подключение к удаленной машине и получение прав root, проверяем через получение данных из /var/log/messagees (1 балл)
    - подключение к удаленной машине, проверяем nginx запущен на порту отличном от дефолтного; тут должно быть 2 теста: одна проверка через http, вторая через подключение ssh (1 балл)
    - выполняем запрос к nginx, подключаемся к удаленной машине и проверяем что добавилась запись в access log (1 балл)
    - подключение к удаленной машине, запретить подключаться по http к nginx через firewalld, убедиться что подключение не проходит, но nginx на машине поднят и работает (1 балл)

#### Сроки сдачи ДЗ

4 мая(включительно)